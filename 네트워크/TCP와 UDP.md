### TCP
- 신뢰할 수 있는 통신을 위한 연결형 프로토콜
- TCP 통신 단계
  - TCP는 통신하기 전에 연결을 수립하고 통신이 끝나면 연결을 종료
  - 1. 연결 수립
  - 2. 데이터 송수신(재전송을 통한 오류 제어, 흐름 제어, 혼잡 제어)
  - 3. 연결 종료
- MSS: TCP로 전송할 수 있는 최대 페이로드 크기
- TCP 세그먼트 구조
  - 송신지 포트, 수진지 포트
    - 송수신하는 포트 번호
  - 순서 번호
    - 순서번호가 명시되는 필드
    - 초기 순서 번호 + 송신한 바이트 수
    - 초기 순서 번호는 무작위 값
    - 순서 번호는 송수신되는 세그먼트 데이터의 첫 바이트에 부여되는 번호로 세그먼트의 올바른 송수신 순서를 보장하기 위해 사용
  - 확인 응답 번호
    - 상대 호스트가 보낸 세그먼트에 대한 응답
    - 다음으로 수신할 순서 번호 명시
  - 제어 비트, 플래그 비트
    - 현재 세그먼트에 대한 부가 정보
    - 기본적으로 8비트 구성
      - ACK: 세그먼트 승인을 나타내는 비트
      - SYN: 연결을 수립하기 위한 비트
      - FIN: 연결을 종료하기 위한 비트
  - 윈도우
    - 수신 윈도우의 크기가 명시
    - 수신 윈도우: 한 번에 수신하고자 하는 데이터의 양
- 연결 수립
  - Three-way handshake
    - 세 개의 단계로 이루어진 TCP의 연결 수립 과정
    - 액티브 오픈: 연결 시작 호스트의 연결 수립 과정
    - 패시브 오픈: 연결 수락 호스트의 연결 수립 과정
    - 연결 종료: 송수신 호스트가 각자 한 번씩 FIN과 ACK를 주고받으며 연결 종료
      - 액티브 클로즈: 종료 시작 호스트의 종료 과정
      - 패시브 클로즈: 종료 수락 호스트의 종료 과정
- TCP 상태
  - 상태: 현재 어떤 통신 과정에 있는지 나타내는 정보
  - TCP는 상태를 유지하는 stateful 프로토콜
  - TCP 상태의 유형
    - 연결이 수립되지 않은 상태
    - 연결 수립 과정에서 주로 볼 수 있는 상태
    - 연결 종료 과정에서 주로 볼 수 있는 상태
- 오류•흐름•혼잡 제어
  - 재전송을 기반으로 다양한 오류 제어
  - 흐름 제어를 통해 처리할 수 있을 만큼의 데이터 송수신
  - 혼잡 제어를 통해 네트워크가 혼잡한 정도에 따라 전송량 조절
- 오류 검출 & 재전송
  - 중복된 ACK 세그먼트를 수신하거나 타임아웃이 발생 시 재전송
  - 재전송 기법: ARQ(Automatic Repeat Request, 자동 재전송 요구)
    - 수신 호스트의 답변과 타임아웃을 토대로 문제를 진단하고 문제가 생긴 메시지 재전송
    - ARQ의 대표적인 방식
      - Stop-and-Wait ARQ
        - 수신 완료 확인 전까지 메시지를 송신하지 않는 방식
        - 장점: 단순하지만, 높은 신뢰성
        - 문제점: 네트워크 이용 효율과 성능이 낮아짐
        - 파이프라이닝
          - 문제점을 해결하기 위한 방법
          - ACK 세그먼트가 도착하기 전이라도 세그먼트 송신 가능한 기술
      - Go-Back-N ARQ
        - 파이프라이닝 기반 ARQ
        - 여러 세그먼트 전송 중 오류 발생시 해당 세그먼트부터 전부 재전송
      - Selective Repeat ARQ
        - 선택적 재전송
        - 각각의 패킷들에 대해 ACK 세그먼트를 보내는 방식
        - 현재 대부분의 호스트는 이 방식 사용
- 흐름 제어
  - 송신 호스트가 수신 호스트의 처리 속도를 고려하여 송수신 속도를 균일하게 유지하는 기능
  - 파이프라이닝 기반 ARQ에서는 흐름 제어 필요
  - 슬라이딩 윈도우
    - TCP에서 사용하는 흐름 제어 기법
    - 윈도우: 송신 호스트가 파이프라이닝 할 수 있는 최대량
    - 윈도우의 크기만큼 확인 응답을 받지 않고 한 번에 전송 가능
    - 수신 호스트는 TCP 헤더를 통해 송신 호스트에게 자신이 받을 데이터의 양을 알림
- 혼잡 제어
  - 혼잡: 많은 트래픽으로 인해 패킷의 처리 속도가 늦어지거나 유실될 우려가 있는 상황
  - 송신 호스트가 혼잡한 정도에 맞춰 유동적으로 전송량을 조절
  - 혼잡 윈도우
    - 혼잡 없이 전송 가능한 데이터 양
    - 혼잡 윈도우가 클수록 한 번에 전송 가능한 세그먼트 수가 많음
    - 수신 윈도우는 수신 호스트가 헤더로 알려주지만 혼잡 윈도우는 송신 호스트가 직접 계산해야함
    - AIMD(Additive Increase/Multiplicative Decrease)
      - 혼잡이 감지되지 않으면 혼잡 윈도우를 RTT(Round Trip Time)마다 1씩 선형적으로 증가
      - 혼잡이 감지되면 혼잡 윈도우를 절반으로 감소
      - RTT: 메시지를 전송한 뒤 그에 대한 답변을 받는 데까지 걸리는 시간
    - slow start 알고리즘
      - 혼잡 윈도우를 1부터 시작해 문제 없이 수신된 ACK 세그먼트 하나당 1씩 증가
      - 혼잡 윈도우는 RTT마다 2배씩 증가(초기 전송 속도 빠른 확보)
      - 혼잡 윈도우 감소
        - 혼잡 윈도우 크기가 임계치 이상
          - 혼잡 윈도우 값을 1로 감소
          - 임계치를 혼잡 감지 시의 혼잡 윈도우의 절반으로 초기화한 뒤 재개
        - 타임아웃 발생
          - slow start 종료
          - 혼잡 회피 수행
        - 세 번의 중복된 ACK 세그먼트 수신
          - 빠른 회복 수해
    - 혼잡 회피
      - RTT마다 혼잡 윈도우를 1MSS씩 증가
      - 혼잡 윈도우 크기 선형적 증가
    - 빠른 회복
      - 빠른 전송률 회복을 위해 느린 시작을 건너뛰고 혼잡 회피 수행
      - 타임아웃 발생 시 slow start 수행
    - ECN
      - 혼잡 회피를 위해 네트워크 중간 장치(주로 라우터)의 도움을 받는 방법
      - 호스트가 ECN 지원 시 TCP/IP 헤더에 ECN 관련 비트 추가
      - ECN 비트를 통해 라우터의 혼잡 상태 여부를 감지하고 그에 따라 혼잡 윈도우 조절
      - 송신 호스트만으로 혼잡 제어 수행시 문제 발생 후에 혼잡 제어 시작
      - ECN을 이용시 수신 호스트의 ACK 세그먼트를 통해 더 빠르게 혼잡 감지

### UDP
- TCP보다 신뢰성은 떨어지지만 비교적 빠른 통신이 가능한 비연결형 프로토콜
- UDP는 TCP와 달리 비연결형 통신 프로토콜로 신뢰할 수 없음
- 연결 수립 및 해제, 재전송을 통한 오류 제어, 혼잡 제어, 흐름 제어 등을 수행하지 않음
- 상태를 유지하지 않는 stateless 프로토콜
- TCP에 비해 적은 오버헤드로 패킷을 빠르게 처리
- UDP 데이터그램 구조
  - 송신지 포트, 수신지 포트
    - 송수신하는 포트 번호
  - 길이
    - 패킷의 길이
  - 체크섬
    - 데이터가 제대로 전달되었는지 확인하는데 사용