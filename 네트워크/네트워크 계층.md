### LAN 간의 통신
- LAN을 넘어 다른 네트워크와 통신
  - IP 주소를 통한 송수신지 대상 지정
  - 라우팅을 통한 다른 네트워크와 통신
- 물리 계층과 데이터 링크 계층의 한계
  - 물리 계층과 데이터 링크 계층만으로는 LAN을 넘어 통신하기 힘듦
  - 다른 네트워크까지의 도달 경로 파악이 힘듦
  - 모든 네트워크에 속한 모든 호스트의 위치를 특정하기 힘듦
- 라우팅
  - 패킷이 이동할 최적의 경로를 결정하는 것
- 라우터
  - 라우팅을 수행하는 대표적인 장비
- IP 주소
  - MAC 주소만으로는 모든 네트워크에 속한 호스트 위치 특정이 힘듦
  - MAC 주소와 IP 주소를 함께 사용
  - 택배로 비유하면 IP는 수신지, MAC은 수신인

### IP
- IP의 공식적인 두 기능: 주소 지정, 단편화
- IPv4
  - 주소 지정
    - IP 주소를 바탕으로 송수신 대상을 지정하는 것
    - 4바이트로 하나의 주소 표현
    - 숫자당 8비트로 표현하고 각 숫자는 점으로 구분
  - 단편화
    - 전송하고자 하는 패킷의 크기를 MTU 이하의 복수 패킷으로 나누는 것
    - MTU(Maximum Transmission Unit)
      - 한 번에 전송 가능한 IP 패킷의 최대 크기
      - IP 패킷의 헤더도 MTU 크기에 포함
      - 일반적인 MTU 크기는 1500바이트, MTU 크기 이하로 나누어진 패킷은 수신지에 도착하면 다시 재조합
  - 패킷 핵심 필드
    - 식별자
      - 패킷에 할당된번호 
      - 쪼개져서 도착한 패킷들이 어떤 메시지에서 쪼개졌는지를 알기 위해 사용
    - 플래그
      - 3개의 비트로 이루어짐
      - 첫 번째 비트는 항상 0으로 사용되지 않음
      - DF 비트: IP 단편화 수행 여부(1이면 수행하지 않고 0이면 수행)
      - MF 비트: 단편화도니 패킷이 더 있는지 여부(1이면 더 있고 0이면 마지막 패킷)
    - 단편화 오프셋
      - 초기 데이터에서 몇 번째로 떨어진 패킷인지 표시
      - 패킷을 재조합하려면 해당패킷이 초기 데이터에서 몇 번째 패킷인지 알아야함
    - TTL
      - 패킷의 수명
      - 무의미한 패킷이 네트워크 상에 지속적으로 남아있는 것을 방지하기 위해 사용
      - 패킷이 라우터를 거칠때마다 TTL이 1씩 감소, 0으로 떨어지면 폐기
    - 프로토콜
      - 상위 계층의 프로토콜을 나타내는 필드
    - 송신지 IP 주소
    - 수신지 IP 주소
- IPv6
  - 16바이트로 주소를 표한하고 콜론으로 구분된 8개 그룹의 16진수로 표기
  - 단편화
    - IPv6는 단편화 확장 헤더를 통해 단편화를 수행
    - 단편화 확장 헤더에도 다음 헤드 필드가 있고 단편화 오프셋(=IPv4 단편화 오프셋), M 플래그(=IPv4 MF 플래그), 식별자(=IPv4 식별자)를 포함
  - 패킷 핵심 필드
    - 다음 헤더
      - 상위 계층의 프로토콜 또는 확장 헤더를 가리키는 필드
      - IPv6는 기본 헤더에 더불어 확장 헤더라는 추가 헤더 보유 가능
    - 홉 제한
      - 패킷의 수명을 나타내는 필드
      - IPv4의 TTL과 비슷
    - 송신지 IP 주소
    - 수신지 IP 주소

### ARP
- IP 주소를 통해 MAC 주소를 알아내는 프로토콜
- 동일 네트워크 내에 있는 송수신 대상의 IP 주소를 통해 MAC 주소를 알아낼 수 있음
- ARP 동작
  - 호스트 A가 호스트 B의 MAC 주소를 찾는 과정
  - 1. ARP 요청
    - 호스트 A가 브로드캐스트 메시지 전송
  - 2. ARP 응답
    - 호스트 B가 자신의 MAC 주소를 담은 유니캐스트 메시지를 전송
  - 3. ARP 테이블 갱신
    - 위 과정을 통해 알게 된 IP 주소와 MAC 주소의 연관 관계를 기록
    - ARP 테이블 항목은 일정 시간이 지나면 삭제되고 임의 삭제도 가능
    - ARP 테이블에 등록된 호스트에 대해서는 ARP 요청을 보낼 필요 없음
- ARP 패킷
  - ARP 요청, 응답 과정에서 송수신되는 패킷
  - 오퍼레이션 코드: 요청은 1, 응답은 2
  - 송수신지 하드웨어 주소
  - 송수신지 프로토콜 주소

### 단편화의 단점
- 단편화는 불필요한 트래픽 증가와 대역폭 낭비를 유발
- 쪼개진 IP 패킷들을 하나로 합치는 과정에서 발생하는 부하도 성능 저하 요소
- 단편화를 피하는 법
  - IP 패킷을 주고 받는 모든 노드가 단편화 없이 주고 받을 수 있는 최대 크기만큼만 전송
  - 단편화 없이 주고 받을 수 있는 최대 크기 = 경로 MTU
    - 경로 MTU만큼의 데이터를 전송하면 단편화를 피할 수 있음
    - 경로 MTU 발견: 경로 MTU를 구하고 해당 크기만큼만 송수신하여 단편화를 회피하는 기법