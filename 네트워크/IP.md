### IP
- IP의 공식적인 두 기능: 주소 지정, 단편화
- IP 주소의 구조
  - 크게 네트워크 주소와 호스트 주소로 구성
  - 네트워크 주소: 호스트가 속한 특정 네트워크를 식별
  - 호스트 주소: 특정 호스트를 식별
  - 호스트 주소 공간을 크게 할당하면 IP 주소 낭비
  - 호스트 주소 공간을 작게 할당하면 호스트가 사용할 IP 주소 부족
  - 이런 문제를 해결하기 위해 클래스 개념 도입
- IPv4
  - 주소 지정
    - IP 주소를 바탕으로 송수신 대상을 지정하는 것
    - 4바이트로 하나의 주소 표현
    - 숫자당 8비트로 표현하고 각 숫자는 점으로 구분
  - 단편화
    - 전송하고자 하는 패킷의 크기를 MTU 이하의 복수 패킷으로 나누는 것
    - MTU(Maximum Transmission Unit)
      - 한 번에 전송 가능한 IP 패킷의 최대 크기
      - IP 패킷의 헤더도 MTU 크기에 포함
      - 일반적인 MTU 크기는 1500바이트, MTU 크기 이하로 나누어진 패킷은 수신지에 도착하면 다시 재조합
  - 패킷 핵심 필드
    - 식별자
      - 패킷에 할당된번호 
      - 쪼개져서 도착한 패킷들이 어떤 메시지에서 쪼개졌는지를 알기 위해 사용
    - 플래그
      - 3개의 비트로 이루어짐
      - 첫 번째 비트는 항상 0으로 사용되지 않음
      - DF 비트: IP 단편화 수행 여부(1이면 수행하지 않고 0이면 수행)
      - MF 비트: 단편화도니 패킷이 더 있는지 여부(1이면 더 있고 0이면 마지막 패킷)
    - 단편화 오프셋
      - 초기 데이터에서 몇 번째로 떨어진 패킷인지 표시
      - 패킷을 재조합하려면 해당패킷이 초기 데이터에서 몇 번째 패킷인지 알아야함
    - TTL
      - 패킷의 수명
      - 무의미한 패킷이 네트워크 상에 지속적으로 남아있는 것을 방지하기 위해 사용
      - 패킷이 라우터를 거칠때마다 TTL이 1씩 감소, 0으로 떨어지면 폐기
    - 프로토콜
      - 상위 계층의 프로토콜을 나타내는 필드
    - 송신지 IP 주소
    - 수신지 IP 주소
- IPv6
  - 16바이트로 주소를 표한하고 콜론으로 구분된 8개 그룹의 16진수로 표기
  - 단편화
    - IPv6는 단편화 확장 헤더를 통해 단편화를 수행
    - 단편화 확장 헤더에도 다음 헤드 필드가 있고 단편화 오프셋(=IPv4 단편화 오프셋), M 플래그(=IPv4 MF 플래그), 식별자(=IPv4 식별자)를 포함
  - 패킷 핵심 필드
    - 다음 헤더
      - 상위 계층의 프로토콜 또는 확장 헤더를 가리키는 필드
      - IPv6는 기본 헤더에 더불어 확장 헤더라는 추가 헤더 보유 가능
    - 홉 제한
      - 패킷의 수명을 나타내는 필드
      - IPv4의 TTL과 비슷
    - 송신지 IP 주소
    - 수신지 IP 주소

### 클래스풀 주소 체계
- 클래스
  - 네트워크 크기에 따라 IP 주소를 분류하는 기준
  - 필요한 호스트 IP 개수에 따라 클래스를 달리 선택하며 네트워크 크기 조정 가능
- A 클래스
  - B와 C 클래스에 비해 할당 가능한 호스트 주소의 수가 많음
  - 네트워크 주소는 비트 '0'으로 시작하는 1옥텟, 호스트 주소는 3옥텟으로 구성
  - 이론상 $$2^7$$개의 A 클래스 네트워크 존재 가능
  - 각 네트워크에 $$2^{24}$$개의 호스트 주소 할당 가능
  - 첫번째 옥텟의 주소가 0~127이면 A 클래스
- B 클래스
  - 네트워크 주소는 비트'10'으로 시작하는 2옥텟, 호스트 주소도 2옥텟으로 구성
  - 이론상 $$2^{14}$$개의 B 클래스 네트워크 존재 가능
  - 각 네트워크에 $$2^{16}$$ 호스트 존재 가능
  - 첫번째 옥텟의 주소가 128~191이면 B 클래스
- C 클래스
  - 네트워크 주소는 비트 '110'으로 시작하는 3옥텟, 호스트 주소는 1옥텟으로 구성
  - 이론상 $$2^{21}$$개의 C 클래스 네트워크 존재 가능
  - 각 네트워크에 $$2^8$$개 호스트 주소 존재 가능
  - 첫번째 옥텟의 주소가 192~223이면 C 클래스
- 호스트의 주소 공간을 모두 사용하는 것은 불가
  - 호스트 주소가 전부 0인 IP는 해당 네트워크 자체를 의미하는 네트워크 주소로 사용
  - 호스트 주소가 전부 1인 IP 주소는 브로드캐스트 주소로 사용
 
### 클래스리스 주소 체계
- 클래스풀 주소 체계의 한계
  - 클래스별 네트워크 크기가 고정되어 여전히 낭비되는 IP 주소가 많을 수 있음
  - 클래스별 네트워크 크기가 고정되어 정해진 크기의 네트워크만 구성 가능
- 클래스리스 주소 체계
  - 클래스 개념 없이 네트워크 영역을 나누고 호스트에게 IP 주소 공간을 할당하는 방식
  - 클래스풀 주소 체계보다 유동적이고 정교한 네트워크 구성 가능
  - 오늘날 주로 활용되는 방식
- 서브넷 마스크
  - 클래스 없이 IP 주소의 네트워크 주소, 호스트 주소를 구분하는 수단
  - IP 주소에서 네트워크 주소는 1, 호스트 주소는 0으로 표기한 비트열
  - ABC 클래스 기본 서브넷 마스크
    - A 클래스: 255.0.0.0
    - B 클래스: 255.255.0.0
    - C 클래스: 255.255.255.0
- 서브네팅
  - 서브넷 마스크를 이용해 클래스를 원하는 크기로 잘게 쪼개어 사용하는 것
  - 서브넷 마스크로 네트워크 주소와 호스트 주소를 구분하는 방법
    - IP 주소와 서브넷 마스크를 비트 AND 연산한 결과 = 네트워크 주소
- 서브넷 마스크 표기법
  - 10진수 표기
    -  255.255.255.0처럼 단순히 10진수로 표기
  - CIDR 표기법
    - IP 주소/서브넷 마스크의 1의 개수 형식으로 표기
    - 192.168.0.1/24처럼 서브넷 마스크의 1의 개수를 뒤에 표기

### IP 주소의 분류
- 공인 IP와 사설 IP
  - 공인 IP 주소
    - 고유한 IP 주소
    - 네트워크 간의 통신에 사용하는 IP 주소
    - ISP나 공인 IP 주소 할당 기관을 통해 할당
  - 사설 IP 주소
    - 사설 네트워크에서 사용하는 IP 주소
    - 사설 IP 주소로 사용하도록 특별히 예약된 주소 공간
    - 일반적으로 라우터나 공유기에서 할당
    - 사설 네트워크 내에서만 유효한 주소로 다른 네트워크상의 사설 IP와 중복 가능
  - NAT
    - IP 주소 변환 기술: 주로 사설 IP 주소와 공인 IP 주소를 변환
    - NAT를 통해 사설 IP 주소를 사용하는 여러 호스트는 적은 수의 공인 IP 주소 공유 가능
- 정적 IP와 동적 IP
  - 정적 할당
    - 호스트에 직접 IP 주소를 부여하는 방식
  - 동적 할당
    - 호스트에 IP 주소를 부여할 때 프로토콜에 따라 자동으로 부여하는 방식
    - 동적 할당에 사용되는 대표적인 프로토콜로 DHCP가 있음
  - 게이트웨이
    - 서로 다른 네트워크를 연결하는 하드웨어/소프트웨어
    - 기본 게이트웨이
      - 호스트가 속한 네트워크 외부로 나가기 위한 기본적인 첫 경로
  - DHCP
    - DHCP 서버
      - 호스트에게 IP 주소를 제공하는 호스트
      - 특정 호스트에 DHCP 서버 기능 추가 가능
      - 클라이언트에 할당 가능한 IP 주소를 관리하며 클라이언트 요청시 할당
      - 일반적으로 라우터에서 기능 수행
    - 클라이언트
      - IP 주소를 할당받고자 하는 호스트
    - 클라이언트와 DHCP 서버 간 메시지 송수신을 통해 IP 주소 할당
    - DHCP로 할당받은 동적 IP 주소는 사용 기간(임대 기간)이 정해지고 기간이 끝나면 DHCP 서버로 반납
    - IP 주소 할당 과정
      - 1. DHCP Discover
        - DHCP 서버를 찾는 메시지
        - 브로드캐스트 전송
        - 클라이언트가 아직 IP 주소를 할당받지 못했으므로 송신지 IP 주소는 0.0.0.0
      - 2. DHCP Offer
        - 클라이언트에게 할당 가능한 IP 주소 정보를 제안하는 메시지
        - 할당 가능한 IP 주소, 서브넷 마스크 임대 기간 등의 정보를 포함
      - 3. DHCP Request
        - DHCP Offer에 대한 응답 메시지
        - 브로드캐스트 전송
      - 4. DHCP ACK
        - 최종 승인 메시지
        - 클라이언트는 할당받은 IP 주소를 자신의 IP 주소로 설정 후 임대 기간 동안 사용
      - 임대 갱신
        - IP 주소 임대 기간이 끝나기 전에 임대 기간을 연장하는 것
        - 기본적으로 두 차례 자동 수행
        - 자동 임대 갱신 실패 시 IP 주소 반납